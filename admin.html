<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ê–¥–º–∏–Ω–∫–∞</title>

<style>
body {
    background:#020617;
    color:#e5e7eb;
    font-family:Arial,sans-serif;
    padding:20px;
}
h1 { margin-bottom:10px; }

input, textarea {
    width:100%;
    padding:12px;
    margin-top:10px;
    border-radius:8px;
    border:none;
    font-size:16px;
}

button {
    width:100%;
    padding:12px;
    margin-top:10px;
    border-radius:8px;
    border:none;
    background:#38bdf8;
    font-weight:bold;
    cursor:pointer;
}

.group {
    background:#0f172a;
    padding:12px;
    border-radius:10px;
    margin-top:12px;
}
.price {
    margin-top:8px;
}

.hidden { display:none; }
</style>
</head>

<body>

<h1>–ê–¥–º–∏–Ω–∫–∞</h1>

<!-- üîê LOGIN -->
<div id="loginBox">
    <input id="loginUser" placeholder="–õ–æ–≥–∏–Ω">
    <input id="loginPass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
    <button onclick="login()">–í–æ–π—Ç–∏</button>
</div>

<!-- ‚öôÔ∏è ADMIN -->
<div id="adminBox" class="hidden">

    <textarea id="input" placeholder="–í—Å—Ç–∞–≤—å –Ω–æ–º–µ—Ä–∞ —Å—é–¥–∞"></textarea>
    <button onclick="analyze()">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–º–µ—Ä–∞</button>

    <div id="groups"></div>

    <button onclick="publish()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ –≤–∏—Ç—Ä–∏–Ω—É</button>
    <button onclick="logout()">–í—ã–π—Ç–∏</button>

</div>

<script>
/* üîê –ê–î–ú–ò–ù–´ */
const ADMINS = {
    admin: "12345",
    jabrail: "2024"
};

let result = [];

/* üîê LOGIN */
function login() {
    const u = document.getElementById("loginUser").value.trim();
    const p = document.getElementById("loginPass").value.trim();

    if (ADMINS[u] && ADMINS[u] === p) {
        document.getElementById("loginBox").classList.add("hidden");
        document.getElementById("adminBox").classList.remove("hidden");
        sessionStorage.setItem("adminLogged", "true");
    } else {
        alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å");
    }
}

/* üîì AUTO LOGIN */
if (sessionStorage.getItem("adminLogged") === "true") {
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("adminBox").classList.remove("hidden");
}

/* üö™ LOGOUT */
function logout() {
    sessionStorage.removeItem("adminLogged");
    location.reload();
}

/* üîé –ê–ù–ê–õ–ò–ó –ù–û–ú–ï–†–û–í */
function analyze() {
    const text = document.getElementById("input").value;
    const digits = text.replace(/\D/g, "");

    let raw = [];
    for (let i = 0; i + 10 < digits.length; i += 11) {
        raw.push(digits.substr(i, 11));
    }

    const phones = raw.map(p => {
        if (p.startsWith("8")) p = "7" + p.slice(1);
        return "+7" + p.slice(1);
    });

    const used = new Set();
    result = [];

    for (let i = 0; i < phones.length; i++) {
        if (used.has(i)) continue;

        let group = [phones[i]];
        used.add(i);

        for (let j = i + 1; j < phones.length; j++) {
            if (used.has(j)) continue;
            if (hamming(phones[i], phones[j]) === 1) {
                group.push(phones[j]);
                used.add(j);
            }
        }

        result.push({
            numbers: group,
            price: 0,
            category: group.length > 1 ? "gold" : "simple"
        });
    }

    renderGroups();
}

/* üßæ –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï */
function renderGroups() {
    const container = document.getElementById("groups");
    container.innerHTML = "";

    result.forEach((g, i) => {
        container.innerHTML += `
        <div class="group">
            <div>${g.numbers.join("<br>")}</div>
            <input class="price" type="number" placeholder="–¶–µ–Ω–∞"
                oninput="result[${i}].price = Number(this.value)">
        </div>`;
    });
}

/* üíæ –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø */
function publish() {
    localStorage.setItem("SHOP_DATA", JSON.stringify(result));
    alert("–ù–æ–º–µ—Ä–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –∏ –≤–∏–¥–Ω—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º");
}

/* üìê –•–≠–ú–ú–ò–ù–ì */
function hamming(a, b) {
    let d = 0;
    for (let i = 0; i < a.length; i++) {
        if (a[i] !== b[i]) d++;
    }
    return d;
}
</script>

</body>
</html>
