<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Админка</title>

<style>
body { background:#020617; color:#e5e7eb; font-family:Arial,sans-serif; padding:20px; }
textarea,input { width:100%; padding:12px; margin-top:10px; border-radius:8px; }
button { padding:12px; margin-top:10px; width:100%; background:#38bdf8; border:none; border-radius:8px; font-weight:bold; }
.group { background:#0f172a; padding:12px; border-radius:10px; margin-top:12px; }
</style>
</head>

<body>
<h1>Админка</h1>

<div id="login">
<input id="loginUser" placeholder="логин">
<input id="loginPass" type="password" placeholder="пароль">
<button onclick="login()">Войти</button>
</div>

<div id="admin" style="display:none">
<textarea id="input" placeholder="Вставь номера"></textarea>
<button onclick="analyze()">Анализировать</button>
<div id="groups"></div>
<button onclick="publish()">Опубликовать в витрину</button>
</div>

<script>
const ADMINS = {
    admin: "12345",
    jabrail: "2024"
};

let result=[];

function login(){
    const u=loginUser.value;
    const p=loginPass.value;
    if(ADMINS[u]===p){
        login.style.display="none";
        admin.style.display="block";
    } else alert("Неверно");
}

function analyze(){
    const digits=input.value.replace(/\D/g,"");
    let raw=[];
    for(let i=0;i+10<digits.length;i+=11) raw.push(digits.substr(i,11));

    const phones=raw.map(p=>{
        if(p.startsWith("8")) p="7"+p.slice(1);
        return "+7"+p.slice(1);
    });

    const used=new Set();
    result=[];

    for(let i=0;i<phones.length;i++){
        if(used.has(i)) continue;
        let g=[phones[i]];
        used.add(i);
        for(let j=i+1;j<phones.length;j++){
            if(used.has(j)) continue;
            if(hamming(phones[i],phones[j])===1){
                g.push(phones[j]);
                used.add(j);
            }
        }
        result.push({numbers:g, price:0, category:g.length>1?"gold":"simple"});
    }

    renderGroups();
}

function renderGroups(){
    groups.innerHTML="";
    result.forEach((g,i)=>{
        groups.innerHTML+=`
        <div class="group">
            <div>${g.numbers.join("<br>")}</div>
            <input placeholder="Цена" oninput="result[${i}].price=+this.value">
        </div>`;
    });
}

function publish(){
    localStorage.setItem("SHOP_DATA", JSON.stringify(result));
    alert("Опубликовано");
}

function hamming(a,b){
    let d=0;
    for(let i=0;i<a.length;i++) if(a[i]!==b[i]) d++;
    return d;
}
</script>
</body>
</html>
